<!DOCTYPE html><html>
<head>
<meta charset="UTF-8" />

<link rel="icon" type="image/png" href="favicon.png" />
<title>pinball player</title>
<style>#maincanvas {
  cursor:crosshair;
}
body {
    -webkit-user-select: none; /* webkit (safari, chrome) browsers */
    -moz-user-select: none; /* mozilla browsers */
    -khtml-user-select: none; /* webkit (konqueror) browsers */
    -ms-user-select: none; /* IE10+ */ 
}
                 select {
                  background-color:black;
                  color:white;
                  text-indent:5px;
                 }
                canvas {
                  position:relative;
                }
                 body {
                 background-color:black;
                 color: gray;
                 margin-top: 0;
                 padding-top: 0;
                 border-top: 0;
                 }
                 ul {
                 list-style-type: none;
                 overflow:hidden; overflow-y:scroll;
                 }
                 input {
                 background-color: black;
                 color:white;
                 text-align: center;
                 font-size: 100%;
                 }
                 input#linkInput {
                 background-color: black;
                 color:white;
                 text-align: center;
                 font-size: 100%;
                 }
                 input#winText {
                  width:90%;
                 }
                 li {
                 font-size: 150%;                 
                  text-align: center;
                  width:100%;
                 }
                 a {
                  color:white;
                 }
                 a.layerItem{
                  color: white;
                  background-color: black;
                  text-decoration: none;
                  width:100%;
                  display:block;
                 }
                 a.layerItem.selectedItem{
                  color: black;
                  background-color: white;
                 }
                 img.selected {
                  border: 2px solid red;
                 }
                 li.selected  {
                 cursor:auto;
                 color:white;
                 }
                 a{
                  white-space:nowrap;
                }
                 div.selected {
                 height:16px; 
                 width:30px;
                 border: 2px solid red;
                 }
                 div.unselected {
                 height:16px; 
                 width:30px;
                 border: 2px solid black;
                 }
                 span.selected {
                 height:16px; 
                 width:30px;
                 border: 2px solid red;
                 }
                 span.unselected {
                 height:16px; 
                 width:30px;
                 border: 2px solid black;
                 }
                 img.radius {
                  border: 1px solid black;
                 }
                 img.selected {
                  border: 1px solid red; 
                 }
                 select {
                 width:100%;
                 -webkit-appearance: none;
                 -moz-appearance: none;
                 }
                 select::-ms-expand {
                 display: none;
                 }
                 canvas#dropdownthumb {
                  border:2px solid gray; 
                  background-color:black;
                 }</style>
<style>
body {
	padding:10px;
}
table {
	border:1px gray solid;
}
tr {
	border:1px gray solid;
}
td {
	border:1px gray solid;
}
#right {
	padding:10px;
}
a {
	color:gray;
}

hr{
	color:gray;
	border: 1px dashed gray;
}
#hackArea {
  width:100%;
  text-align: right;
}
</style>
<script>function goFullscreen(a){a=a||window.event;if(a.keyCode===70){var b=document.getElementById("mainCanvas");b.requestFullscreen?b.requestFullscreen():b.msRequestFullscreen?b.msRequestFullscreen():b.mozRequestFullScreen?b.mozRequestFullScreen():b.webkitRequestFullscreen&&b.webkitRequestFullscreen()}}var embeddedArray=["__EmbedBegin__","__EMBED__","__EmbedEnd__"],embeddedDat=embeddedArray[1],PLAYER=!0;document.addEventListener("keydown",goFullscreen)
</script>
<script>var saveAs=saveAs||typeof navigator!="undefined"&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(a){"use strict";if(typeof navigator!="undefined"&&/MSIE [1-9]\./.test(navigator.userAgent))return;var b=a.document,c=function(){return a.URL||a.webkitURL||a},d=b.createElementNS("http://www.w3.org/1999/xhtml","a"),e="download"in d,f=function(c){var d=b.createEvent("MouseEvents");d.initMouseEvent("click",!0,!1,a,0,0,0,0,0,!1,!1,!1,!1,0,null),c.dispatchEvent(d)},g=a.webkitRequestFileSystem,h=a.requestFileSystem||g||a.mozRequestFileSystem,i=function(b){(a.setImmediate||a.setTimeout)(function(){throw b},0)},j="application/octet-stream",k=0,l=500,m=function(b){var d=function(){typeof b=="string"?c().revokeObjectURL(b):b.remove()};a.chrome?d():setTimeout(d,l)},n=function(a,b,c){b=[].concat(b);var d=b.length;while(d--){var e=a["on"+b[d]];if(typeof e=="function")try{e.call(a,c||a)}catch(f){i(f)}}},o=function(b,i){var l=this,o=b.type,p=!1,q,r,s=function(){n(l,"writestart progress write writeend".split(" "))},t=function(){if(p||!q)q=c().createObjectURL(b);if(r)r.location.href=q;else{var d=a.open(q,"_blank");d==undefined&&typeof safari!="undefined"&&(a.location.href=q)}l.readyState=l.DONE,s(),m(q)},u=function(a){return function(){if(l.readyState!==l.DONE)return a.apply(this,arguments)}},v={create:!0,exclusive:!1},w;l.readyState=l.INIT,i||(i="download");if(e){q=c().createObjectURL(b),d.href=q,d.download=i,f(d),l.readyState=l.DONE,s(),m(q);return}/^\s*(?:text\/(?:plain|xml)|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(b.type)&&(b=new Blob(["ï»¿",b],{type:b.type})),a.chrome&&o&&o!==j&&(w=b.slice||b.webkitSlice,b=w.call(b,0,b.size,j),p=!0),g&&i!=="download"&&(i+=".download");if(o===j||g)r=a;if(!h){t();return}k+=b.size,h(a.TEMPORARY,k,u(function(a){a.root.getDirectory("saved",v,u(function(a){var c=function(){a.getFile(i,v,u(function(a){a.createWriter(u(function(c){c.onwriteend=function(b){r.location.href=a.toURL(),l.readyState=l.DONE,n(l,"writeend",b),m(a)},c.onerror=function(){var a=c.error;a.code!==a.ABORT_ERR&&t()},"writestart progress write abort".split(" ").forEach(function(a){c["on"+a]=l["on"+a]}),c.write(b),l.abort=function(){c.abort(),l.readyState=l.DONE},l.readyState=l.WRITING}),t)}),t)};a.getFile(i,{create:!1},u(function(a){a.remove(),c()}),u(function(a){a.code===a.NOT_FOUND_ERR?c():t()}))}),t)}),t)},p=o.prototype,q=function(a,b){return new o(a,b)};return p.abort=function(){var a=this;a.readyState=a.DONE,n(a,"abort")},p.readyState=p.INIT=0,p.WRITING=1,p.DONE=2,p.error=p.onwritestart=p.onprogress=p.onwrite=p.onabort=p.onerror=p.onwriteend=null,q}(typeof self!="undefined"&&self||typeof window!="undefined"&&window||this.content);typeof module!="undefined"&&module.exports?module.exports.saveAs=saveAs:typeof define!="undefined"&&define!==null&&define.amd!=null&&define([],function(){return saveAs})
</script>
<script>function RC4(a){this.s=new Array(256),this.i=0,this.j=0;for(var b=0;b<256;b++)this.s[b]=b;a&&this.mix(a)}function print_call_stack(){var a=new Error,b=a.stack;console.log(b)}function RNG(a){this.seed=a,a==null?a=(Math.random()+Date.now()).toString():typeof a=="function"?(this.uniform=a,this.nextByte=function(){return~~(this.uniform()*256)},a=null):Object.prototype.toString.call(a)!=="[object String]"&&(a=JSON.stringify(a)),this._normal=null,a?this._state=new RC4(a):this._state=null}String.prototype.getBytes=function(){var a=[];for(var b=0;b<this.length;b++){var c=this.charCodeAt(b),d=[];do d.push(c&255),c>>=8;while(c>0);a=a.concat(d.reverse())}return a},RC4.prototype._swap=function(a,b){var c=this.s[a];this.s[a]=this.s[b],this.s[b]=c},RC4.prototype.mix=function(a){var b=a.getBytes(),c=0;for(var d=0;d<this.s.length;d++)c+=this.s[d]+b[d%b.length],c%=256,this._swap(d,c)},RC4.prototype.next=function(){return this.i=(this.i+1)%256,this.j=(this.j+this.s[this.i])%256,this._swap(this.i,this.j),this.s[(this.s[this.i]+this.s[this.j])%256]},RNG.prototype.nextByte=function(){return this._state.next()},RNG.prototype.uniform=function(){var a=7,b=0;for(var c=0;c<a;c++)b*=256,b+=this.nextByte();return b/(Math.pow(2,a*8)-1)},RNG.prototype.random=function(a,b){return a==null?this.uniform():(b==null&&(b=a,a=0),a+Math.floor(this.uniform()*(b-a)))},RNG.prototype.normal=function(){if(this._normal!==null){var a=this._normal;return this._normal=null,a}var b=this.uniform()||Math.pow(2,-53),c=this.uniform();return this._normal=Math.sqrt(-2*Math.log(b))*Math.sin(2*Math.PI*c),Math.sqrt(-2*Math.log(b))*Math.cos(2*Math.PI*c)},RNG.prototype.exponential=function(){return-Math.log(this.uniform()||Math.pow(2,-53))},RNG.prototype.poisson=function(a){var b=Math.exp(-(a||1)),c=0,d=1;do c++,d*=this.uniform();while(d>b);return c-1},RNG.prototype.gamma=function(a){var b=(a<1?1+a:a)-1/3,c=1/Math.sqrt(9*b);do{do var d=this.normal(),e=Math.pow(c*d+1,3);while(e<=0);var f=this.uniform(),g=Math.pow(d,2)}while(f>=1-.0331*g*g&&Math.log(f)>=.5*g+b*(1-e+Math.log(e)));return a<1?b*e*Math.exp(this.exponential()/-a):b*e},RNG.roller=function(a,b){var c=a.split(/(\d+)?d(\d+)([+-]\d+)?/).slice(1),d=parseFloat(c[0])||1,e=parseFloat(c[1]),f=parseFloat(c[2])||0;return b=b||new RNG,function(){var a=d+f;for(var c=0;c<d;c++)a+=b.random(e);return a}}
</script>
<script>function Params(){var a={};return a.wave_type=SQUARE,a.p_env_attack=0,a.p_env_sustain=.3,a.p_env_punch=0,a.p_env_decay=.4,a.p_base_freq=.3,a.p_freq_limit=0,a.p_freq_ramp=0,a.p_freq_dramp=0,a.p_vib_strength=0,a.p_vib_speed=0,a.p_arp_mod=0,a.p_arp_speed=0,a.p_duty=0,a.p_duty_ramp=0,a.p_repeat_speed=0,a.p_pha_offset=0,a.p_pha_ramp=0,a.p_lpf_freq=1,a.p_lpf_ramp=0,a.p_lpf_resonance=0,a.p_hpf_freq=0,a.p_hpf_ramp=0,a.sound_vol=.5,a.sample_rate=44100,a.bit_depth=8,a}function frnd(a){return seeded?rng.uniform()*a:Math.random()*a}function rnd(a){return seeded?Math.floor(rng.uniform()*(a+1)):Math.floor(Math.random()*(a+1))}function SoundEffect(a,b){this._buffer=AUDIO_CONTEXT.createBuffer(1,a,b)}function cacheSeed(a){if(a in sfxCache)return sfxCache[a];var b=generateFromSeed(a);b.sound_vol=SOUND_VOL,b.sample_rate=SAMPLE_RATE,b.bit_depth=BIT_DEPTH;var c=SoundEffect.generate(b);sfxCache[a]=c,cachedSeeds.push(a);while(cachedSeeds.length>CACHE_MAX){var d=cachedSeeds[0];cachedSeeds=cachedSeeds.slice(1),delete sfxCache[d]}return c}function playSound(a,b){var c=Math.round(bpx)+1e5*Math.round(bpy)+a*1e3;if(b!==!0&&c===lastSoundCoord)return;var d=cacheSeed(a);d.play(),lastSoundCoord=c}var SOUND_VOL=.25,SAMPLE_RATE=5512,BIT_DEPTH=8,SQUARE=0,SAWTOOTH=1,SINE=2,NOISE=3,TRIANGLE=4,BREAKER=5,SHAPES=["square","sawtooth","sine","noise","triangle","breaker"],AUDIO_CONTEXT;typeof AudioContext!="undefined"?AUDIO_CONTEXT=new AudioContext:typeof webkitAudioContext!="undefined"&&(AUDIO_CONTEXT=new webkitAudioContext);var masterVolume=1,rng,seeded=!1;pickupCoin=function(){var a=Params();a.wave_type=Math.floor(frnd(SHAPES.length)),a.wave_type===3&&(a.wave_type=0),a.p_base_freq=.4+frnd(.5),a.p_env_attack=0,a.p_env_sustain=frnd(.1),a.p_env_decay=.1+frnd(.4),a.p_env_punch=.3+frnd(.3);if(rnd(1)){a.p_arp_speed=.5+frnd(.2);var b=(frnd(7)|1)+1,c=b+(frnd(7)|1)+2;a.p_arp_mod=+b/+c}return a},laserShoot=function(){var a=Params();return a.wave_type=rnd(2),a.wave_type===SINE&&rnd(1)&&(a.wave_type=rnd(1)),a.wave_type=Math.floor(frnd(SHAPES.length)),a.wave_type===3&&(a.wave_type=SQUARE),a.p_base_freq=.5+frnd(.5),a.p_freq_limit=a.p_base_freq-.2-frnd(.6),a.p_freq_limit<.2&&(a.p_freq_limit=.2),a.p_freq_ramp=-0.15-frnd(.2),rnd(2)===0&&(a.p_base_freq=.3+frnd(.6),a.p_freq_limit=frnd(.1),a.p_freq_ramp=-0.35-frnd(.3)),rnd(1)?(a.p_duty=frnd(.5),a.p_duty_ramp=frnd(.2)):(a.p_duty=.4+frnd(.5),a.p_duty_ramp=-frnd(.7)),a.p_env_attack=0,a.p_env_sustain=.1+frnd(.2),a.p_env_decay=frnd(.4),rnd(1)&&(a.p_env_punch=frnd(.3)),rnd(2)===0&&(a.p_pha_offset=frnd(.2),a.p_pha_ramp=-frnd(.2)),rnd(1)&&(a.p_hpf_freq=frnd(.3)),a},explosion=function(){var a=Params();return rnd(1)?(a.p_base_freq=.1+frnd(.4),a.p_freq_ramp=-0.1+frnd(.4)):(a.p_base_freq=.2+frnd(.7),a.p_freq_ramp=-0.2-frnd(.2)),a.p_base_freq*=a.p_base_freq,rnd(4)===0&&(a.p_freq_ramp=0),rnd(2)===0&&(a.p_repeat_speed=.3+frnd(.5)),a.p_env_attack=0,a.p_env_sustain=.1+frnd(.3),a.p_env_decay=frnd(.5),rnd(1)===0&&(a.p_pha_offset=-0.3+frnd(.9),a.p_pha_ramp=-frnd(.3)),a.p_env_punch=.2+frnd(.6),rnd(1)&&(a.p_vib_strength=frnd(.7),a.p_vib_speed=frnd(.6)),rnd(2)===0&&(a.p_arp_speed=.6+frnd(.3),a.p_arp_mod=.8-frnd(1.6)),a},birdSound=function(){var a=Params();if(frnd(10)<1)return a.wave_type=Math.floor(frnd(SHAPES.length)),a.wave_type===3&&(a.wave_type=SQUARE),a.p_env_attack=.4304400932967592+frnd(.2)-.1,a.p_env_sustain=.15739346034252394+frnd(.2)-.1,a.p_env_punch=.004488201744871758+frnd(.2)-.1,a.p_env_decay=.07478075528212291+frnd(.2)-.1,a.p_base_freq=.9865265720147687+frnd(.2)-.1,a.p_freq_limit=0+frnd(.2)-.1,a.p_freq_ramp=-0.2995018224359539+frnd(.2)-.1,frnd(1)<.5&&(a.p_freq_ramp=.1+frnd(.15)),a.p_freq_dramp=.004598608156964473+frnd(.1)-.05,a.p_vib_strength=-0.2202799497929496+frnd(.2)-.1,a.p_vib_speed=.8084998703158364+frnd(.2)-.1,a.p_arp_mod=0,a.p_arp_speed=0,a.p_duty=-0.9031808754347107+frnd(.2)-.1,a.p_duty_ramp=-0.8128699999808343+frnd(.2)-.1,a.p_repeat_speed=.601486018931999+frnd(.2)-.1,a.p_pha_offset=-0.9424902314367765+frnd(.2)-.1,a.p_pha_ramp=-0.1055482222272056+frnd(.2)-.1,a.p_lpf_freq=.9989765717851521+frnd(.2)-.1,a.p_lpf_ramp=-0.25051720626043017+frnd(.2)-.1,a.p_lpf_resonance=.32777871505494693+frnd(.2)-.1,a.p_hpf_freq=.0023548750981756753+frnd(.2)-.1,a.p_hpf_ramp=-0.002375673204842568+frnd(.2)-.1,a;if(frnd(10)<1)return a.wave_type=Math.floor(frnd(SHAPES.length)),a.wave_type===3&&(a.wave_type=SQUARE),a.p_env_attack=.5277795946672003+frnd(.2)-.1,a.p_env_sustain=.18243733568468432+frnd(.2)-.1,a.p_env_punch=-0.020159754546840117+frnd(.2)-.1,a.p_env_decay=.1561353422051903+frnd(.2)-.1,a.p_base_freq=.9028855606533718+frnd(.2)-.1,a.p_freq_limit=-0.008842787837148716,a.p_freq_ramp=-0.1,a.p_freq_dramp=-0.012891241489551925,a.p_vib_strength=-0.17923136138403065+frnd(.2)-.1,a.p_vib_speed=.908263385610142+frnd(.2)-.1,a.p_arp_mod=.41690153355414894+frnd(.2)-.1,a.p_arp_speed=.0010766233195860704+frnd(.2)-.1,a.p_duty=-0.8735363011184684+frnd(.2)-.1,a.p_duty_ramp=-0.7397985366747507+frnd(.2)-.1,a.p_repeat_speed=.0591789344172107+frnd(.2)-.1,a.p_pha_offset=-0.9961184222777699+frnd(.2)-.1,a.p_pha_ramp=-0.08234769395850523+frnd(.2)-.1,a.p_lpf_freq=.9412475115697335+frnd(.2)-.1,a.p_lpf_ramp=-0.18261358925834958+frnd(.2)-.1,a.p_lpf_resonance=.24541438107389477+frnd(.2)-.1,a.p_hpf_freq=-0.01831940280978611+frnd(.2)-.1,a.p_hpf_ramp=-0.03857383633171346+frnd(.2)-.1,a;if(frnd(10)<1)return a.wave_type=Math.floor(frnd(SHAPES.length)),a.wave_type===3&&(a.wave_type=SQUARE),a.p_env_attack=.4304400932967592+frnd(.2)-.1,a.p_env_sustain=.15739346034252394+frnd(.2)-.1,a.p_env_punch=.004488201744871758+frnd(.2)-.1,a.p_env_decay=.07478075528212291+frnd(.2)-.1,a.p_base_freq=.9865265720147687+frnd(.2)-.1,a.p_freq_limit=0+frnd(.2)-.1,a.p_freq_ramp=-0.2995018224359539+frnd(.2)-.1,a.p_freq_dramp=.004598608156964473+frnd(.2)-.1,a.p_vib_strength=-0.2202799497929496+frnd(.2)-.1,a.p_vib_speed=.8084998703158364+frnd(.2)-.1,a.p_arp_mod=-0.46410459213693644+frnd(.2)-.1,a.p_arp_speed=-0.10955361249587248+frnd(.2)-.1,a.p_duty=-0.9031808754347107+frnd(.2)-.1,a.p_duty_ramp=-0.8128699999808343+frnd(.2)-.1,a.p_repeat_speed=.7014860189319991+frnd(.2)-.1,a.p_pha_offset=-0.9424902314367765+frnd(.2)-.1,a.p_pha_ramp=-0.1055482222272056+frnd(.2)-.1,a.p_lpf_freq=.9989765717851521+frnd(.2)-.1,a.p_lpf_ramp=-0.25051720626043017+frnd(.2)-.1,a.p_lpf_resonance=.32777871505494693+frnd(.2)-.1,a.p_hpf_freq=.0023548750981756753+frnd(.2)-.1,a.p_hpf_ramp=-0.002375673204842568+frnd(.2)-.1,a;if(frnd(5)>1)return a.wave_type=Math.floor(frnd(SHAPES.length)),a.wave_type===3&&(a.wave_type=SQUARE),rnd(1)?(a.p_arp_mod=.2697849293151393+frnd(.2)-.1,a.p_arp_speed=-0.3131172257760948+frnd(.2)-.1,a.p_base_freq=.8090588299313949+frnd(.2)-.1,a.p_duty=-0.6210022920964955+frnd(.2)-.1,a.p_duty_ramp=-0.00043441813553182567+frnd(.2)-.1,a.p_env_attack=.004321877246874195+frnd(.2)-.1,a.p_env_decay=.1+frnd(.2)-.1,a.p_env_punch=.061737781504416146+frnd(.2)-.1,a.p_env_sustain=.4987252564798832+frnd(.2)-.1,a.p_freq_dramp=.31700340314222614+frnd(.2)-.1,a.p_freq_limit=0+frnd(.2)-.1,a.p_freq_ramp=-0.163380391341416+frnd(.2)-.1,a.p_hpf_freq=.4709005021145149+frnd(.2)-.1,a.p_hpf_ramp=.6924667290539194+frnd(.2)-.1,a.p_lpf_freq=.8351398631384511+frnd(.2)-.1,a.p_lpf_ramp=.36616557192873134+frnd(.2)-.1,a.p_lpf_resonance=-0.08685777111664439+frnd(.2)-.1,a.p_pha_offset=-0.036084571580025544+frnd(.2)-.1,a.p_pha_ramp=-0.014806445085568108+frnd(.2)-.1,a.p_repeat_speed=-0.8094368475518489+frnd(.2)-.1,a.p_vib_speed=.4496665457171294+frnd(.2)-.1,a.p_vib_strength=.23413762515532424+frnd(.2)-.1):(a.p_arp_mod=-0.35697118026766184+frnd(.2)-.1,a.p_arp_speed=.3581140690559588+frnd(.2)-.1,a.p_base_freq=1.3260897696157528+frnd(.2)-.1,a.p_duty=-0.30984900436710694+frnd(.2)-.1,a.p_duty_ramp=-0.0014374759133411626+frnd(.2)-.1,a.p_env_attack=.3160357835682254+frnd(.2)-.1,a.p_env_decay=.1+frnd(.2)-.1,a.p_env_punch=.24323114016870148+frnd(.2)-.1,a.p_env_sustain=.4+frnd(.2)-.1,a.p_freq_dramp=.2866475886237244+frnd(.2)-.1,a.p_freq_limit=0+frnd(.2)-.1,a.p_freq_ramp=-0.10956352368742976+frnd(.2)-.1,a.p_hpf_freq=.20772718017889846+frnd(.2)-.1,a.p_hpf_ramp=.1564090637378835+frnd(.2)-.1,a.p_lpf_freq=.6021372770637031+frnd(.2)-.1,a.p_lpf_ramp=.24016227139979027+frnd(.2)-.1,a.p_lpf_resonance=-0.08787383821160144+frnd(.2)-.1,a.p_pha_offset=-0.381597686151701+frnd(.2)-.1,a.p_pha_ramp=-0.0002481687661373495+frnd(.2)-.1,a.p_repeat_speed=.07812112809425686+frnd(.2)-.1,a.p_vib_speed=-0.13648848579133943+frnd(.2)-.1,a.p_vib_strength=.0018874158972302657+frnd(.2)-.1),a;a.wave_type=Math.floor(frnd(SHAPES.length));if(a.wave_type===1||a.wave_type===3)a.wave_type=2;return a.p_base_freq=.85+frnd(.15),a.p_freq_ramp=.3+frnd(.15),a.p_env_attack=0+frnd(.09),a.p_env_sustain=.2+frnd(.3),a.p_env_decay=0+frnd(.1),a.p_duty=frnd(2)-1,a.p_duty_ramp=Math.pow(frnd(2)-1,3),a.p_repeat_speed=.5+frnd(.1),a.p_pha_offset=-0.3+frnd(.9),a.p_pha_ramp=-frnd(.3),a.p_arp_speed=.4+frnd(.6),a.p_arp_mod=.8+frnd(.1),a.p_lpf_resonance=frnd(2)-1,a.p_lpf_freq=1-Math.pow(frnd(1),3),a.p_lpf_ramp=Math.pow(frnd(2)-1,3),a.p_lpf_freq<.1&&a.p_lpf_ramp<-0.05&&(a.p_lpf_ramp=-a.p_lpf_ramp),a.p_hpf_freq=Math.pow(frnd(1),5),a.p_hpf_ramp=Math.pow(frnd(2)-1,5),a},pushSound=function(){var a=Params();return a.wave_type=Math.floor(frnd(SHAPES.length)),a.wave_type===2&&a.wave_type++,a.wave_type===0&&(a.wave_type=NOISE),a.p_base_freq=.1+frnd(.4),a.p_freq_ramp=.05+frnd(.2),a.p_env_attack=.01+frnd(.09),a.p_env_sustain=.01+frnd(.09),a.p_env_decay=.01+frnd(.09),a.p_repeat_speed=.3+frnd(.5),a.p_pha_offset=-0.3+frnd(.9),a.p_pha_ramp=-frnd(.3),a.p_arp_speed=.6+frnd(.3),a.p_arp_mod=.8-frnd(1.6),a},powerUp=function(){var a=Params();return rnd(1)?a.wave_type=SAWTOOTH:a.p_duty=frnd(.6),a.wave_type=Math.floor(frnd(SHAPES.length)),a.wave_type===3&&(a.wave_type=SQUARE),rnd(1)?(a.p_base_freq=.2+frnd(.3),a.p_freq_ramp=.1+frnd(.4),a.p_repeat_speed=.4+frnd(.4)):(a.p_base_freq=.2+frnd(.3),a.p_freq_ramp=.05+frnd(.2),rnd(1)&&(a.p_vib_strength=frnd(.7),a.p_vib_speed=frnd(.6))),a.p_env_attack=0,a.p_env_sustain=frnd(.4),a.p_env_decay=.1+frnd(.4),a},hitHurt=function(){return result=Params(),result.wave_type=rnd(2),result.wave_type===SINE&&(result.wave_type=NOISE),result.wave_type===SQUARE&&(result.p_duty=frnd(.6)),result.wave_type=Math.floor(frnd(SHAPES.length)),result.p_base_freq=.2+frnd(.6),result.p_freq_ramp=-0.3-frnd(.4),result.p_env_attack=0,result.p_env_sustain=frnd(.1),result.p_env_decay=.1+frnd(.2),rnd(1)&&(result.p_hpf_freq=frnd(.3)),result},jump=function(){return result=Params(),result.wave_type=SQUARE,result.wave_type=Math.floor(frnd(SHAPES.length)),result.wave_type===3&&(result.wave_type=SQUARE),result.p_duty=frnd(.6),result.p_base_freq=.3+frnd(.3),result.p_freq_ramp=.1+frnd(.2),result.p_env_attack=0,result.p_env_sustain=.1+frnd(.3),result.p_env_decay=.1+frnd(.2),rnd(1)&&(result.p_hpf_freq=frnd(.3)),rnd(1)&&(result.p_lpf_freq=1-frnd(.6)),result},blipSelect=function(){return result=Params(),result.wave_type=rnd(1),result.wave_type=Math.floor(frnd(SHAPES.length)),result.wave_type===3&&(result.wave_type=rnd(1)),result.wave_type===SQUARE&&(result.p_duty=frnd(.6)),result.p_base_freq=.2+frnd(.4),result.p_env_attack=0,result.p_env_sustain=.1+frnd(.1),result.p_env_decay=frnd(.2),result.p_hpf_freq=.1,result},random=function(){return result=Params(),result.wave_type=Math.floor(frnd(SHAPES.length)),result.p_base_freq=Math.pow(frnd(2)-1,2),rnd(1)&&(result.p_base_freq=Math.pow(frnd(2)-1,3)+.5),result.p_freq_limit=0,result.p_freq_ramp=Math.pow(frnd(2)-1,5),result.p_base_freq>.7&&result.p_freq_ramp>.2&&(result.p_freq_ramp=-result.p_freq_ramp),result.p_base_freq<.2&&result.p_freq_ramp<-0.05&&(result.p_freq_ramp=-result.p_freq_ramp),result.p_freq_dramp=Math.pow(frnd(2)-1,3),result.p_duty=frnd(2)-1,result.p_duty_ramp=Math.pow(frnd(2)-1,3),result.p_vib_strength=Math.pow(frnd(2)-1,3),result.p_vib_speed=frnd(2)-1,result.p_env_attack=Math.pow(frnd(2)-1,3),result.p_env_sustain=Math.pow(frnd(2)-1,2),result.p_env_decay=frnd(2)-1,result.p_env_punch=Math.pow(frnd(.8),2),result.p_env_attack+result.p_env_sustain+result.p_env_decay<.2&&(result.p_env_sustain+=.2+frnd(.3),result.p_env_decay+=.2+frnd(.3)),result.p_lpf_resonance=frnd(2)-1,result.p_lpf_freq=1-Math.pow(frnd(1),3),result.p_lpf_ramp=Math.pow(frnd(2)-1,3),result.p_lpf_freq<.1&&result.p_lpf_ramp<-0.05&&(result.p_lpf_ramp=-result.p_lpf_ramp),result.p_hpf_freq=Math.pow(frnd(1),5),result.p_hpf_ramp=Math.pow(frnd(2)-1,5),result.p_pha_offset=Math.pow(frnd(2)-1,3),result.p_pha_ramp=Math.pow(frnd(2)-1,3),result.p_repeat_speed=frnd(2)-1,result.p_arp_speed=frnd(2)-1,result.p_arp_mod=frnd(2)-1,result};var generators=[pickupCoin,laserShoot,explosion,powerUp,hitHurt,jump,blipSelect,pushSound,random,birdSound],generatorNames=["pickupCoin","laserShoot","explosion","powerUp","hitHurt","jump","blipSelect","pushSound","random","birdSound"];generateFromSeed=function(a){rng=new RNG(a/100|0);var b=a%100,c=generators[b%generators.length];seeded=!0;var d=c();return d.seed=a,seeded=!1,d},SoundEffect.prototype.getBuffer=function(){return this._buffer.getChannelData(0)},SoundEffect.prototype.play=function(){var a=AUDIO_CONTEXT.createBufferSource();a.buffer=this._buffer,a.connect(AUDIO_CONTEXT.destination);var b=AUDIO_CONTEXT.currentTime;typeof a.start!="undefined"?a.start(b):a.noteOn(b)},SoundEffect.MIN_SAMPLE_RATE=22050,typeof AUDIO_CONTEXT=="undefined"&&(SoundEffect=function(b,c){this._sample_rate=c,this._buffer=new Array(b),this._audioElement=null},SoundEffect.prototype.getBuffer=function(){return this._audioElement=null,this._buffer},SoundEffect.prototype.play=function(){if(this._audioElement)this._audioElement.cloneNode(!1).play();else{for(var a=0;a<this._buffer.length;a++)this._buffer[a]=255&Math.floor(128*Math.max(0,Math.min(this._buffer[a]+1,2)));var b=MakeRiff(this._sample_rate,BIT_DEPTH,this._buffer);this._audioElement=new Audio,this._audioElement.src=b.dataURI,this._audioElement.play()}},SoundEffect.MIN_SAMPLE_RATE=1),SoundEffect.generate=function(a){function b(){c=0,d=100/(a.p_base_freq*a.p_base_freq+.001),e=Math.floor(d),f=100/(a.p_freq_limit*a.p_freq_limit+.001),g=1-Math.pow(a.p_freq_ramp,3)*.01,h=-Math.pow(a.p_freq_dramp,3)*1e-6,i=.5-a.p_duty*.5,j=-a.p_duty_ramp*5e-5,a.p_arp_mod>=0?k=1-Math.pow(a.p_arp_mod,2)*.9:k=1+Math.pow(a.p_arp_mod,2)*10,l=0,m=Math.floor(Math.pow(1-a.p_arp_speed,2)*2e4+32),a.p_arp_speed==1&&(m=0)}var c,d,e,f,g,h,i,j,k,l,m;b();var n=0,o=0,p=Math.pow(a.p_lpf_freq,3)*.1,q=1+a.p_lpf_ramp*1e-4,r=5/(1+Math.pow(a.p_lpf_resonance,2)*20)*(.01+p);r>.8&&(r=.8);var s=0,t=Math.pow(a.p_hpf_freq,2)*.1,u=1+a.p_hpf_ramp*3e-4,v=0,w=Math.pow(a.p_vib_speed,2)*.01,x=a.p_vib_strength*.5,y=0,z=0,A=0,B=[Math.floor(a.p_env_attack*a.p_env_attack*1e5),Math.floor(a.p_env_sustain*a.p_env_sustain*1e5),Math.floor(a.p_env_decay*a.p_env_decay*1e5)],C=B[0]+B[1]+B[2],D=0,E=Math.pow(a.p_pha_offset,2)*1020;a.p_pha_offset<0&&(E=-E);var F=Math.pow(a.p_pha_ramp,2)*1;a.p_pha_ramp<0&&(F=-F);var G=Math.abs(Math.floor(E)),H=0,I=[];for(var J=0;J<1024;++J)I[J]=0;var K=[];for(var J=0;J<32;++J)K[J]=Math.random()*2-1;var L=Math.floor(Math.pow(1-a.p_repeat_speed,2)*2e4+32);a.p_repeat_speed==0&&(L=0);var M=2*a.sound_vol,M=Math.exp(a.sound_vol)-1,N=0,O=0,P=0,Q=Math.floor(44100/a.sample_rate),R=0,S=Math.ceil(C/Q),T=!1,U;a.sample_rate<SoundEffect.MIN_SAMPLE_RATE?U=new SoundEffect(4*S,SoundEffect.MIN_SAMPLE_RATE):U=new SoundEffect(S,a.sample_rate);var V=U.getBuffer();for(var W=0;;++W){L!=0&&++c>=L&&b(),m!=0&&W>=m&&(m=0,d*=k),g+=h,d*=g,d>f&&(d=f,a.p_freq_limit>0&&(T=!0));var X=d;x>0&&(v+=w,X=d*(1+Math.sin(v)*x)),e=Math.floor(X),e<8&&(e=8),i+=j,i<0&&(i=0),i>.5&&(i=.5),A++,A>B[z]&&(A=0,z++,z===3&&(T=!0)),z===0?y=A/B[0]:z===1?y=1+Math.pow(1-A/B[1],1)*2*a.p_env_punch:y=1-A/B[2],E+=F,G=Math.abs(Math.floor(E)),G>1023&&(G=1023),u!=0&&(t*=u,t<1e-5&&(t=1e-5),t>.1&&(t=.1));var Y=0;for(var Z=0;Z<8;++Z){var $=0;D++;if(D>=e){D%=e;if(a.wave_type===NOISE)for(var J=0;J<32;++J)K[J]=Math.random()*2-1}var _=D/e;if(a.wave_type===SQUARE)_<i?$=.5:$=-0.5;else if(a.wave_type===SAWTOOTH)$=1-_*2;else if(a.wave_type===SINE)$=Math.sin(_*2*Math.PI);else if(a.wave_type===NOISE)$=K[Math.floor(D*32/e)];else if(a.wave_type===TRIANGLE)$=Math.abs(1-_*2)-1;else if(a.wave_type===BREAKER)$=Math.abs(1-_*_*2)-1;else throw new Exception("bad wave type! "+a.wave_type);var ba=n;p*=q,p<0&&(p=0),p>.1&&(p=.1),a.p_lpf_freq!=1?(o+=($-n)*p,o-=o*r):(n=$,o=0),n+=o,s+=n-ba,s-=s*t,$=s,I[H&1023]=$,$+=I[H-G+1024&1023],H=H+1&1023,Y+=$*y}O+=Y;if(++P>=Q)P=0,Y=O/Q,O=0;else continue;Y=Y/8*masterVolume,Y*=M,V[R++]=Y,a.sample_rate<SoundEffect.MIN_SAMPLE_RATE&&(V[R++]=Y,V[R++]=Y,V[R++]=Y);if(T){for(;R<S;R++)a.sample_rate<SoundEffect.MIN_SAMPLE_RATE&&(V[R++]=0,V[R++]=0,V[R++]=0),V[R]=0;break}}return U};if(typeof exports!="undefined"){var RIFFWAVE=require("./riffwave").RIFFWAVE;exports.Params=Params,exports.generate=generate}var sfxCache={},cachedSeeds=[],CACHE_MAX=50,lastSoundCoord=-1
</script>
<script>function qualifyURL(a){return aurl.href=a,aurl.href}function buildStandalone(a){if(standalone_HTML_String.length===0){alert("Can't export yet - still downloading html template.",!0);return}a=encodeURI(a);var b=standalone_HTML_String.concat("");b="<!--Save as html file-->\n"+b,b=b.replace(/__EMBED__/g,a);var c=get_blob(),d=new c([b],{type:"text/plain;charset=utf-8"});saveAs(d,gameTitle+".html")}function exportClick(){var a=stateToString();buildStandalone(a)}function importClick(){var a=new FileReader;a.onload=function(b){var c=a.result},a.readAsText(file,encoding)}function connectCables(a,b){var c=null,d=-1,e=null,f=-1;for(var g=0;g<connections.length;g++){var h=connections[g];h.indexOf(a)>=0&&(c=h,d=g),h.indexOf(b)>=0&&(e=h,f=g);if(c!==null&&c===e)return}if(f<d){var i=c;c=e,e=i;var j=d;d=f,f=j;var k=a;a=b,b=k}e===null?e=[b]:connections.splice(f,1),c===null?c=[a]:connections.splice(d,1),connections.push(c.concat(e).unique())}function makeConnections(){var a=masterCanvas;connections=[],activatedConnections=[];for(var b=0;b<width-1;b++)for(var c=0;c<height-1;c++){var d=b+width*c,e=a[d],f=e===connectionCol||e===targetCol||e===togglableWallCol;if(f===!1)continue;var g=d+1,h=d+width,i=regionCanvas[d],j=regionCanvas[g],k=regionCanvas[h],l=a[g],m=a[h],n=l===connectionCol||l===targetCol||l===togglableWallCol,o=m===connectionCol||m===targetCol||m===togglableWallCol;n&&i!==j&&connectCables(i,j),o&&j!==k&&i!==k&&connectCables(i,k)}}function shareClick(){var a=gameTitle,b=stateToString(),c={description:a,"public":!0,files:{"readme.txt":{content:"A game made with www.flipcode.org"},"game.txt":{content:b}}},d="https://api.github.com/gists",e=new XMLHttpRequest;e.open("POST",d),e.onreadystatechange=function(){var a=0;if(e.readyState!=4)return;var b=JSON.parse(e.responseText);if(e.status===403)a++,alert(b.message);else if(e.status!==200&&e.status!==201)a++,alert("HTTP Error "+e.status+" - "+e.statusText);else{var c=b.id,d="play.html?p="+c;d=qualifyURL(d);var f="editor.html?hack="+c;f=qualifyURL(f);var g='link to source code:<br><a href="'+f+'">'+f+"</a>",h=document.getElementById("shareLink");h.innerHTML='<a target="_blank" href="'+d+'">&#8627;'+c+"</a><br>",shareLinkInner=h.childNodes[0],a>0&&alert("Cannot link directly to playable game, because there are errors.",!0),PLAYER!==!0&&window.history.pushState({},"plingpling game maker","index.html?p="+c)}},e.setRequestHeader("Content-type","application/x-www-form-urlencoded");var f=JSON.stringify(c);e.send(f),lastDownTarget=masterCanvas}function RLE_encode(a){var b=[],c,d,e;for(d=1,c=a[0],e=1;e<a.length;e++)a[e]!=c?(b.push(d),b.push(c),d=1,c=a[e]):d++;return b.push(d),b.push(c),b}function RLE_decode(a){var b="";return a.forEach(function(a){b+=(new Array(1+a[0])).join(a[1])}),b}function stateToString(){var a=new Object;a.gameTitle=gameTitle,a.winText=winText,a.gameLink=gameLink,a.canvasIndex=canvasIndex,a.canvasses=new Array,a.mainPaletteOffset=mainPaletteOffset,a.version=VERSION;for(var b=0;b<layerCount;b++){var c=levelCanvasses[b],d="";for(var e=0;e<width*height;e++)d+=c[e].toString(16);var f=RLE_encode(d);a.canvasses.push(f)}var g=JSON.stringify(a);return g}function findPageName(){var a=window.location.href;return a}function makeKey(a){return findPageName()+a}function stringToState(a){var b=JSON.parse(a);gameTitle=b.gameTitle,winText=b.winText,gameLink=b.gameLink,version=b.version,b.version==null&&(b.version=1),mainPaletteOffset=0;var c=localStorage.getItem(makeKey("highScore"));highScore=c|0,"mainPaletteOffset"in b&&cyclePalette(b.mainPaletteOffset),stateIndex=0,canvasIndex=b.canvasIndex,canvasIndex==null&&(canvasIndex=0),levelCanvasses=new Array;for(var c=0;c<layerCount;c++){var d=b.canvasses[c],e=new Uint8Array(width*height);levelCanvasses.push(e);if(b.version===1&&c>0)continue;var f=0;for(var g=0;g<d.length;g+=2){var h=d[g],i=d[g+1];for(var j=0;j<h;j++)e[f]=parseInt(i,16),f++}}setLevel(1),stateIndex=0,compile(),setScoreText(!0)}function applyCanvasSweep(a){var b=Math.round(bpx),c=Math.round(bpy),d=[[b+1,c+0],[b+2,c+0],[b+0,c+1],[b+1,c+1],[b+2,c+1],[b+3,c+1],[b+0,c+2],[b+1,c+2],b+2+width*(c+2),[b+3,c+2],[b+1,c+3],[b+2,c+3]],e=0,f=0;for(var g=0;g<d.length;g++){var h=d[g][0],i=d[g][1];if(h>=0&&h<width&&i>=0&&i<height){var j=h+width*i,k=a[j];if(k!==0){var l=k%width,m=Math.floor(k/width),n=l-h,o=m-i;n*n+o*o>e*e+f*f&&(e=n,f=o)}}}if(e!==0||f!==0){var p=[-speedX,-speedY],q=[e,f],r=subV(mulV(2*dot(q,p),q),p);speedX=r[0],speedY=r[1]}bpx+=e,bpy+=f,speedX+=e,speedY+=f,clampSpeed();var s=0,t=0;e>0?s=1:e<0&&(s=-1),f>0?t=1:f<0&&(t=-1),s===0&&t===0&&(t=-1)}function interpolateAreas(a,b){var c=a%2,d=b%2,e=Math.floor(a/2)%2,f=Math.floor(b/2)%2,g=Math.floor(a/4)%2,h=Math.floor(b/4)%2;g===1&&h===0?hasSpring&&playSound(62826107,!0):g===0&&h===1?hasSpring&&playSound(67535707,!0):c===0&&d===1?hasLeftPaddle&&playSound(64004107,!0):e===0&&f===1&&hasRightPaddle&&playSound(64004107,!0);var i=[a];if(c!=d){var j=i[i.length-1]-c+d;i.push(j)}if(e!=f){var j=i[i.length-1]-e*2+f*2;i.push(j)}if(g!=h){var j=i[i.length-1]-g*4+h*4;i.push(j)}return i}function setstateIndex(a,b){dirty&&compile();var c=interpolateAreas(a,b);for(var d=0;d<c.length-1;d++){var e=c[d],f=c[d+1],g=sweepAreas[e][f];if(g==null){console.log("setstateIndex not found "+e+" -> "+f);return}applyCanvasSweep(g)}}function setFlipperCanvas(){var a=stateIndex;stateIndex=0,keyBuffer[37]===!0&&(stateIndex=1),keyBuffer[39]===!0&&(stateIndex+=2),keyBuffer[40]===!0&&(stateIndex+=4),tilting=keyBuffer[38],a!=stateIndex&&(setstateIndex(a,stateIndex),setVisuals())}function keyup(a){a=a||window.event,keyBuffer[a.keyCode]=!1,setFlipperCanvas()}function prevent(a){return a.preventDefault&&a.preventDefault(),a.stopImmediatePropagation&&a.stopImmediatePropagation(),a.stopPropagation&&a.stopPropagation(),a.returnValue=!1,!1}function setLevel(a,b){if(a-1===canvasIndex&&b!==!0)return;canvasIndex=a-1,masterCanvas=levelCanvasses[canvasIndex];if(PLAYER!==!0){for(var c=0;c<layerCount;c++)layerElem[c]!==null&&layerElem[c].setAttribute("class","layerItem");layerElem[canvasIndex].setAttribute("class","layerItem selectedItem")}compile(),setVisuals()}function drawThumbnail(a){thumbCtx=thumbnailContext[a],thumbCtx.fillStyle="#FF0000",thumbCtx.fillRect(0,0,16,10);var b=levelCanvasses[a];for(var c=0;c<25;c++)for(var d=0;d<28;d++){var e=0;for(var f=0;f<10;f++)for(var g=0;g<10;g++){var h=b[c*5+f+width*(d*5+g)];h>e&&(e=h)}thumbCtx.fillStyle=colorPalette[e],thumbCtx.fillRect(c,d,1,1)}}function press(a){a=a||window.event,keyBuffer[a.keyCode]=!0,[32,37,38,39,40].indexOf(a.keyCode)>-1&&prevent(a);if(a.keyCode===188)cyclePalette(-1);else if(a.keyCode===190)cyclePalette(1);else if(a.keyCode===38&&tilting===!1)playSound(72335902,!0);else if(a.keyCode===80)compile(),spawnBall();else if(a.keyCode===82)exitTriggered&&compile(),spawnBall();else if(a.keyCode===67)copyImage=JSON.stringify(masterCanvas);else if(a.keyCode===86){if(copyImage!==null){preserveUndoState();var b=JSON.parse(copyImage),c=new Uint8Array(width*height);for(var d=0;d<width*height;d++)c[d]=b[d];masterCanvas=c,compile(),setVisuals(!0)}}else if(a.keyCode===189||a.keyCode===173){var e=["eraser",eraserCol,"wall",wallCol,"bumper",bumperCol,"flipper",flipperCol,"ballSpawn",ballSpawnCol,"exitPoint",exitCol,"spring",springCol,"leftFlipperPivot",leftFlipperPivotCol,"rightFlipperPivot",rightFlipperPivotCol,"connection",connectionCol,"target",targetCol,"togglableWall",togglableWallCol],f=e.indexOf(activeTool);if(f>0){var g=e[f-2],h=e[f-1];selectTool(g,h)}}else if(a.keyCode===187||a.keyCode===61){var e=["eraser",eraserCol,"wall",wallCol,"bumper",bumperCol,"flipper",flipperCol,"ballSpawn",ballSpawnCol,"exitPoint",exitCol,"spring",springCol,"leftFlipperPivot",leftFlipperPivotCol,"rightFlipperPivot",rightFlipperPivotCol,"connection",connectionCol,"target",targetCol,"togglableWall",togglableWallCol],f=e.indexOf(activeTool);if(f+2<e.length){var g=e[f+2],h=e[f+3];selectTool(g,h)}}else if(a.keyCode===90&&undoList.length>0){var i=undoList.pop();setLevel(i.canvasIndex+1);for(var d=0;d<i.canvasDat.length;d++)masterCanvas[d]=i.canvasDat[d];compile(),setVisuals(!0,!0),shareLinkInner!=null&&(shareLinkInner.style.color="gray")}setFlipperCanvas()}function getRandomInt(a,b){return Math.floor(Math.random()*(b-a))+a}function titleChange(a){gameTitle=a}function linkChange(a){gameLink=a}function winTextChange(a){winText=a}function clearPalette(){preserveUndoState();var a=masterCanvas;for(var b=0;b<width*height;b++)a[b]=0;var c=canvasses[0];for(var b=0;b<c.length;b++)c[b]=masterCanvas[b];bpx=-1e3,bpy=-1e3,speedX=0,speedY=0,setVisuals(!0)}function ballCollides(){var a=Math.round(bpx),b=Math.round(bpy),c=[a+1+width*(b+0),a+2+width*(b+0),a+0+width*(b+1),a+1+width*(b+1),a+2+width*(b+1),a+3+width*(b+1),a+0+width*(b+2),a+1+width*(b+2),a+2+width*(b+2),a+3+width*(b+2),a+1+width*(b+3),a+2+width*(b+3)],d=canvasses[stateIndex];for(var e=0;e<c.length;e++){var f=c[e],g=d[f];if(g>0&&g!==bumperAuraCol&&g!==ballSpawnCol&&g!==exitCol&&g!==connectionCol)return!0}return!1}function activateSwitch(a){var b=regionCanvas[a],c=boundingBoxes[b];for(var d=c[0];d<=c[2];d++)for(var e=c[1];e<=c[3];e++){var f=d+width*e;if(regionCanvas[f]===b)for(var g=0;g<canvasses.length;g++){var h=canvasses[g];h[f]===targetCol&&(h[f]=targetActiveCol)}}var i=-1;for(var f=0;f<connections.length;f++){var j=connections[f];if(j.indexOf(b)>=0){i=f;break}}if(i===-1){playSound(89718103,!0);return}activatedConnections.push(b);var j=connections[i],k=0,l=0,m=0,n=0;for(var f=0;f<j.length;f++){var o=j[f],p=regionTypes[o];p===connectionCol?k++:p===togglableWallCol?m++:p===targetCol&&(l++,activatedConnections.indexOf(o)>=0&&n++)}n===l?(removeTogglableWalls(j),playSound(66445903,!0)):playSound(89718103,!0)}function removeTogglableWalls(a){for(var b=0;b<a.length;b++){var c=a[b],d=regionTypes[c];if(d!==togglableWallCol)continue;var e=boundingBoxes[c];for(var f=e[0];f<=e[2];f++)for(var g=e[1];g<=e[3];g++){var h=f+width*g;if(regionCanvas[h]===c)for(var i=0;i<canvasses.length;i++){var j=canvasses[i];j[h]===togglableWallCol&&(j[h]=togglableWallDisabledCol)}}}}function collision(a,b){var c=canvasses[stateIndex],d=[];for(var e=0;e<ballOffsets.length;e++){var f=ballOffsets[e],g=f[0]+a,h=f[1]+b;if(g<0||g>=width||h<0){var i=Math.floor(g)+.5,j=Math.floor(h)+.5,k=i-a-2,l=j-b-2;d.push([wallCol,-k,-l]);continue}var m=g+width*h,n=c[m];if(n===targetCol)activateSwitch(m);else if(n>0&&n!==bumperAuraCol&&n!==ballSpawnCol&&n!==exitCol&&n!==connectionCol&&n!==targetActiveCol&&n!==togglableWallDisabledCol){var i=m%width+.5,j=Math.floor(m/width)+.5,k=i-a-2,l=j-b-2;d.push([n,-k,-l,m])}}return d}function dot(a,b){return a[0]*b[0]+a[1]*b[1]}function mag(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function normalized(a){var b=mag(a);return[a[0]/b,a[1]/b]}function addV(a,b){return[a[0]+b[0],a[1]+b[1]]}function subV(a,b){return[a[0]-b[0],a[1]-b[1]]}function mulV(a,b){return[a*b[0],a*b[1]]}function clampSpeed(){var a=[speedX,speedY],b=mag(a);b>maxSpeed&&(speedN=normalized(a),a=mulV(maxSpeed,speedN),speedX=a[0],speedY=a[1]),Math.abs(ballSpin)>maxBallSpin&&(ballSpin=ballSpin/Math.abs(ballSpin)*maxBallSpin)}function tick(){var a=Math.round(bpx)+1e3*Math.round(bpy);a!==lastsoundpos_bump&&(lastsoundpos_bump=-1),oldscore!==score&&(score>highScore&&(highScore=score,localStorage.setItem(makeKey("highScore"),highScore)),setScoreText()),PLAYER&&loaded&&(bpy<-500||bpy>height+5)&&exitTriggered===!1&&spawnBall(),bumperHit=-1;var b=ballSpin>0?1:-1;ballFrame=((ballFrame+b*Math.sqrt(Math.abs(ballSpin))*ballSpinSpeed)%4+4)%4;var c=speedX,d=speedY,e=canvasses[stateIndex];if(bpx<-10){(PLAYER&&exitTriggered||tilting===!0)&&setVisuals();return}var f=.002;speedY+=f*tickLength,clampSpeed();var g=bpx+speedX,h=bpy+speedY,i=Math.round(g),j=Math.round(h),k=collision(i,j);if(k.length===0)bpx=g,bpy=h,(isNaN(bpx)||isNaN(bpy))&&console.log("eek nan"),tickRecalcs=0,ballSpin*=1-spinDamp*tickLength;else{var l=0,m=0,n=0;for(var o=0;o<k.length;o++){var p=k[o][1],q=k[o][2];l+=p,m+=q,k[o][0]===bumperCol&&(n++,bumperHit=regionCanvas[k[o][3]])}l/=k.length,m/=k.length;if(l===0&&m===0)if(speedX!==0||speedY!==0)l=-speedY,m=speedX;else return;var r=normalized([l,m]),s=[-speedX,-speedY],t=67922907;if(n>0){score+=200,t=64236300;var u=mag(s);u+=bumperSpeed,u>maxSpeed&&(u=maxSpeed),s=mulV(u,normalized(s)),speedX=s[0],speedY=s[1],clampSpeed()}var v=Math.round(bpx)+1e3*Math.round(bpy);v!==lastsoundpos_bump&&playSound(t,n===0),lastsoundpos_bump=v;var w=s[0]*r[1]-s[1]*r[0],x=subV(mulV(2*dot(r,s),r),s);speedX=bounceDamp*x[0],speedY=bounceDamp*x[1],leftV=[-r[1],r[0]];var y=1;speedX+=y*ballSpin*leftV[0]/2,speedY+=y*ballSpin*leftV[1]/2,ballSpin/=2,ballSpin+=w*mag([speedX,speedY])*(1-bounceDamp)/2,clampSpeed(),g=bpx+speedX,h=bpy+speedY,tickRecalcs++;var k=collision(Math.round(g),Math.round(h));if(k.length===0)bpx=g,bpy=h,(isNaN(bpx)||isNaN(bpy))&&console.log("eek nan"),tickRecalcs=0;else{if(tickRecalcs<4){tick();return}bpx=g,bpy=h}}var z=Math.round(bpx),A=Math.round(bpy);exitTriggered===!1&&z<=exitPointX&&exitPointX<=z+4&&A<=exitPointY&&exitPointY<=A+4&&(canvasIndex+1<gameLevelCount?(setLevel(canvasIndex+2),spawnBall()):(exitTriggered=!0,wonindex=13,bpx=-1e3,bpy=-1e3,alert(winText+"\n score : "+score),setScoreText(!0),playSound(81031108)),tilting=!1,keyBuffer[38]=!1),setVisuals()}function init(){setInterval(tick,tickLength);if(PLAYER===!0)scoreText=document.getElementById("scoreText"),highScoreText=document.getElementById("highScoreText"),setScoreText();else{titleInput=document.getElementById("titleInput"),titleInput.value=gameTitle,linkInput=document.getElementById("linkInput"),linkInput.value=gameLink;for(var a=0;a<layerCount;a++)elem=document.getElementById("thumbnail"+(a+1)),thumbnailCanvas[a]=elem,thumbnailContext[a]=elem.getContext("2d");for(var a=0;a<layerCount;a++)elem=document.getElementById("layerItem"+(a+1)),layerElem[a]=elem;winTextInput=document.getElementById("winText"),winTextInput.value=winText;for(var a=0;a<16;a++)elem=document.getElementById("color_"+a),elem!==null&&(elem.style.backgroundColor=colorPalette[a],colorElem[a]=elem);elem=document.getElementById("colorOffsetChoice"),elem!==null&&(elem.style.backgroundColor=colorPalette[0])}visibleCanvas=document.getElementById("mainCanvas");if(PLAYER!==!0){visibleCanvas.addEventListener("mousedown",mouseDown,!1),visibleCanvas.addEventListener("mouseup",mouseUp,!1),visibleCanvas.addEventListener("mousemove",mouseMove,!1),visibleCanvas.addEventListener("mouseout",mouseOut,!1);var b=document.getElementById("my_file");b.addEventListener("change",readFile,!1),window.addEventListener("mouseup",mouseUp,!1)}visibleContext=visibleCanvas.getContext("2d"),visibleContext.imageSmoothingEnabled=!1,id=visibleContext.createImageData(1,1),id_d=id.data,setLevel(1,!0),setVisuals(!0),getData(),setScoreText(!0)}function readFile(a){var b=a.target.files[0];if(b){var c=new FileReader;c.onload=function(a){var b=a.target.result,c="__EmbedBegin__",d="__EmbedEnd__",e=b.indexOf(c),f=b.indexOf(d),g=b.substr(e+c.length+2+1,f-2-e-(c.length+2)-2),h=decodeURI(g);stringToState(h),setTexts(),loaded=!0,setLevel(canvasIndex+1),setVisuals(!0,!0)},c.readAsText(b)}else alert("Failed to load file")}function getParameterByName(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return c==null?"":decodeURIComponent(c[1].replace(/\+/g," "))}function strip_http(a){return a=a.replace(/^https?:\/\//,""),a}function setTexts(){if(PLAYER===!0){var a=document.getElementById("homepageLinkPlayer"),b=document.getElementById("gameTitleHeader"),c=gameLink;a.innerHTML=strip_http(c),c.match(/^https?:\/\//)||(c="http://"+c),a.href=c,b.innerText=gameTitle,document.title=gameTitle}else titleInput.value=gameTitle,linkInput.value=gameLink,winTextInput.value=winText}function getData(){if(embeddedDat[0]!=="_"){embeddedDat=decodeURI(embeddedDat),stringToState(embeddedDat),setVisuals(!0,!0),setTexts(),loaded=!0;return}var a=getParameterByName("p").replace(/[\\\/]/,"");if(a===null||a.length===0)return;var b=document.getElementById("hackLink"),c="index.html?p="+a;c=qualifyURL(c),b!=null&&(b.href=c,b.innerHTML="&sdotb; edit");var d="https://api.github.com/gists/"+a,e=new XMLHttpRequest;e.open("GET",d),e.onreadystatechange=function(){if(e.readyState!=4)return;var a=JSON.parse(e.responseText);e.status===403?alert(a.message):e.status!==200&&e.status!==201&&alert("HTTP Error "+e.status+" - "+e.statusText);var a=JSON.parse(e.responseText),b=a.files["game.txt"].content;stringToState(b),setTexts(),loaded=!0,setVisuals(!0,!0)},e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.send()}function setVisuals(a,b){if(PLAYER&&loaded===!1){visibleContext.fillStyle="#ff0000",visibleContext.fillRect(0,0,visibleCanvas.width/2,visibleCanvas.height/2),visibleContext.fillStyle="#00ff00",visibleContext.fillRect(visibleCanvas.width/2,0,visibleCanvas.width/2,visibleCanvas.height/2),visibleContext.fillStyle="#ff00ff",visibleContext.fillRect(0,visibleCanvas.height/2,visibleCanvas.width/2,visibleCanvas.height/2),visibleContext.fillStyle="#00ffff",visibleContext.fillRect(visibleCanvas.width/2,visibleCanvas.height/2,visibleCanvas.width/2,visibleCanvas.height/2);return}var c=canvasses[stateIndex],d=zoomFactor;tilting&&(d-=Math.random()*.1,speedX+=(Math.random()*2-1)*.2,speedY+=(Math.random()*2-1)*.2,clampSpeed());if(exitTriggered&&PLAYER===!0){wonindex=(wonindex+1)%(colorPalette.length*15);var e=Math.floor(wonindex/15);for(var f=0;f<width;f++)for(var g=0;g<height;g++){var h=(c[f+width*g]+e)%colorPalette.length;visibleContext.fillStyle=colorPalette[h],h===bumperCol&&bumperHit>=0&&regionCanvas[f+width*g]===bumperHit&&(visibleContext.fillStyle=colorPalette[18]),visibleContext.fillRect(f*d,g*d,d,d)}return}for(var f=0;f<width;f++)for(var g=0;g<height;g++){var h=c[f+width*g];visibleContext.fillStyle=colorPalette[h],h===bumperCol&&bumperHit>=0&&regionCanvas[f+width*g]===bumperHit&&(visibleContext.fillStyle=colorPalette[18]),visibleContext.fillRect(f*d,g*d,d,d)}if(mag([speedX,speedY])>2){var i=ballPointFrames[Math.floor(lastBallFrame)];visibleContext.fillStyle="#888888";for(var f=0;f<i.length;f++){var j=i[f],k=Math.round(lastbpx+j[0]),l=Math.round(lastbpy+j[1]);visibleContext.fillRect(k*d,l*d,d,d)}}var i=ballPointFrames[Math.floor(ballFrame)];visibleContext.fillStyle="#ffffff";for(var f=0;f<i.length;f++){var j=i[f],k=Math.round(bpx+j[0]),l=Math.round(bpy+j[1]);visibleContext.fillRect(k*d,l*d,d,d)}lastbpy=bpy,lastbpx=bpx,PLAYER===!1&&(titleInput.value=gameTitle,linkInput.value=gameLink,winTextInput.value=winText),lastBallFrame=Math.floor(ballFrame);if(PLAYER!==!0&&a===!0)if(b===!0)for(var f=0;f<layerCount;f++)drawThumbnail(f);else drawThumbnail(canvasIndex)}function getCoords(a){var b,c;if(typeof a.offsetX!="undefined")b=a.offsetX,c=a.offsetY;else{var d=a.target||a.srcElement,e=d.getBoundingClientRect();b=a.clientX-e.left,c=a.clientY-e.top}return[b,c]}function uint8ar_copy(a){var b=new Uint8Array(width*height);for(var c=0;c<a.length;c++)b[c]=a[c];return b}function preserveUndoState(){dirty=!0,bpx=-1e3,bpy=-1e3,console.log("preserving undo state");var a=new Object;a.canvasDat=uint8ar_copy(masterCanvas),a.canvasIndex=canvasIndex,undoList.push(a),undoList.length>30&&undoList.shift(),shareLinkInner!=null&&(shareLinkInner.style.color="gray")}function mouseDown(a){a=a||window.event,drawing=1;var b=getCoords(a);startTargetX=b[0],startTargetY=b[1],lastX=Math.floor(-1+startTargetX/zoomFactor),lastY=Math.floor(-1+startTargetY/zoomFactor),preserveUndoState(),mouseMove(a,a.type==="mousedown"),radius===0&&(drawing=0)}function mouseUp(a){a=a||window.event,calcHalo(),setVisuals(),drawing=0,lastX=-1,lastY=-1}function mouseOut(a){a=a||window.event,mouseMove(a),lastX=-1,lastY=-1}function selectTool(a,b){activeTool=a;for(var c=0;c<16;c++){var d=colorElem[c];d!=null&&d.setAttribute("class","unselected")}colorElem[b].setAttribute("class","selected")}function line(a,b,c,d){var e=new Array,f=Math.abs(c-a),g=Math.abs(d-b),h=a<c?1:-1,i=b<d?1:-1,j=f-g;e.push([a,b]);while(a!=c||b!=d){var k=j<<1;k>-g&&(j-=g,a+=h),k<f&&(j+=f,b+=i),e.push([a,b])}return e}function eraserDraw(a,b){var c=[[a-1,b+2],[a,b+2],[a+1,b+2],[a-2,b+1],[a-1,b+1],[a,b+1],[a+1,b+1],[a+2,b+1],[a-2,b],[a-1,b],[a,b],[a+1,b],[a+2,b],[a-2,b-1],[a-1,b-1],[a,b-1],[a+1,b-1],[a+2,b-1],[a-1,b-2],[a,b-2],[a+1,b-2]];for(var d=0;d<c.length;d++){var e=c[d][0],f=c[d][1];e>=0&&e<width&&f>=0&&f<height&&(masterCanvas[e+width*f]=eraserCol)}}function wallDraw(a,b){var c=[[a,b],[a-1,b],[a,b+1],[a+1,b],[a,b-1]];for(var d=0;d<c.length;d++){var e=c[d][0],f=c[d][1];e>=0&&e<width&&f>=0&&f<height&&(masterCanvas[e+width*f]=wallCol)}}function bumperDraw(a,b){var c=[[a,b],[a-1,b],[a,b+1],[a+1,b],[a,b-1]];for(var d=0;d<c.length;d++){var e=c[d][0],f=c[d][1];e>=0&&e<width&&f>=0&&f<height&&(masterCanvas[e+width*f]=bumperCol)}}function flipperDraw(a,b){var c=[[a,b],[a-1,b],[a,b+1],[a+1,b],[a,b-1]],d=!1;for(var e=0;e<c.length;e++){var f=c[e][0],g=c[e][1];f>=0&&f<width&&g>=0&&g<height&&(k=masterCanvas[f+width*g],k!==leftFlipperPivotCol&&k!==rightFlipperPivotCol&&(masterCanvas[f+width*g]=flipperCol))}neighbours=[[a+1,b],[a,b+1],[a-1,b],[a,b-1]],fillCanvas[a+width*b]=1;if(masterCanvas[a+width*b]===leftFlipperPivotCol||masterCanvas[a+width*b]===rightFlipperPivotCol)d=!0;for(var e=0;e<neighbours.length;e++){var h=neighbours[e],i=h[0],j=h[1];if(i>=0&&i<width&&j>=0&&j<height&&fillCanvas[i+width*j]===0){var k=masterCanvas[i+width*j];if(k===leftFlipperPivotCol||k===rightFlipperPivotCol||k===flipperCol){if(d)masterCanvas[i+width*j]=flipperCol;else if(k===leftFlipperPivotCol||k===rightFlipperPivotCol)d=!0;fillCanvas[i+width*j]=1,neighbours.push([i+1,j]),neighbours.push([i-1,j]),neighbours.push([i,j+1]),neighbours.push([i,j-1])}}}d===!1&&(a<=width/2?masterCanvas[a+width*b]=leftFlipperPivotCol:masterCanvas[a+width*b]=rightFlipperPivotCol);for(var e=0;e<width*height;e++)fillCanvas[e]=0}function leftFlipperPivotDraw(a,b){var c=a,d=b;c>=0&&c<width&&d>=0&&d<height&&(masterCanvas[c+width*d]=leftFlipperPivotCol),neighbours=[[c+1,d],[c,d+1],[c-1,d],[c,d-1]];for(var e=0;e<neighbours.length;e++){var f=neighbours[e],g=f[0],h=f[1];g>=0&&g<width&&h>=0&&h<height&&(masterCanvas[g+width*h]=flipperCol)}fillCanvas[c+width*d]=1;for(var e=0;e<neighbours.length;e++){var f=neighbours[e],g=f[0],h=f[1];if(g>=0&&g<width&&h>=0&&h<height&&fillCanvas[g+width*h]===0){var i=masterCanvas[g+width*h];if(i===leftFlipperPivotCol||i===rightFlipperPivotCol||i===flipperCol)masterCanvas[g+width*h]=flipperCol,fillCanvas[g+width*h]=1,neighbours.push([g+1,h]),neighbours.push([g-1,h]),neighbours.push([g,h+1]),neighbours.push([g,h-1])}}for(var e=0;e<width*height;e++)fillCanvas[e]=0}function rightFlipperPivotDraw(a,b){var c=a,d=b;c>=0&&c<width&&d>=0&&d<height&&(masterCanvas[c+width*d]=rightFlipperPivotCol),neighbours=[[c+1,d],[c,d+1],[c-1,d],[c,d-1]];for(var e=0;e<neighbours.length;e++){var f=neighbours[e],g=f[0],h=f[1];g>=0&&g<width&&h>=0&&h<height&&(masterCanvas[g+width*h]=flipperCol)}fillCanvas[c+width*d]=1;for(var e=0;e<neighbours.length;e++){var f=neighbours[e],g=f[0],h=f[1];if(g>=0&&g<width&&h>=0&&h<height&&fillCanvas[g+width*h]===0){var i=masterCanvas[g+width*h];if(i===leftFlipperPivotCol||i===rightFlipperPivotCol||i===flipperCol)masterCanvas[g+width*h]=flipperCol,fillCanvas[g+width*h]=1,neighbours.push([g+1,h]),neighbours.push([g-1,h]),neighbours.push([g,h+1]),neighbours.push([g,h-1])}}for(var e=0;e<width*height;e++)fillCanvas[e]=0}function ballSpawnDraw(a,b){var c=a,d=b;for(var e=0;e<width*height;e++)masterCanvas[e]===ballSpawnCol&&(masterCanvas[e]=0);c<3?c=3:c>width-3&&(c=width-3),d<3?d=3:d>height-3&&(d=height-3);var f=[[c-3,d-0],[c-3,d-1],[c-2,d-2],[c-1,d-3],[c+0,d-3],[c+1,d-2],[c+2,d-1],[c+2,d-0],[c+1,d+1],[c+0,d+2],[c-1,d+2],[c-2,d+1]];for(var e=0;e<f.length;e++){var g=f[e];masterCanvas[g[0]+width*g[1]]=ballSpawnCol}}function connectionDraw(a,b){var c=[[a,b],[a-1,b],[a,b-1],[a-1,b-1]];for(var d=0;d<c.length;d++){var e=c[d][0],f=c[d][1];e>=0&&e<width&&f>=0&&f<height&&(masterCanvas[e+width*f]=connectionCol)}}function targetDraw(a,b){var c=[[a,b],[a-1,b],[a,b+1],[a+1,b],[a,b-1]];for(var d=0;d<c.length;d++){var e=c[d][0],f=c[d][1];e>=0&&e<width&&f>=0&&f<height&&(masterCanvas[e+width*f]=targetCol)}}function togglableWallDraw(a,b){var c=[[a,b],[a-1,b],[a,b+1],[a+1,b],[a,b-1]];for(var d=0;d<c.length;d++){var e=c[d][0],f=c[d][1];e>=0&&e<width&&f>=0&&f<height&&(masterCanvas[e+width*f]=togglableWallCol)}}function springDraw(a,b){var c=[[a,b],[a-1,b],[a,b+1],[a+1,b],[a,b-1]];for(var d=0;d<c.length;d++){var e=c[d][0],f=c[d][1];e>=0&&e<width&&f>=0&&f<height&&(masterCanvas[e+width*f]=springCol)}}function exitPointDraw(a,b){var c=a,d=b;for(var e=0;e<width*height;e++)masterCanvas[e]===exitCol&&(masterCanvas[e]=0);c<2?c=2:c>width-3&&(c=width-3),d<2?d=2:d>height-3&&(d=height-3);var f=[[c,d],[c-1,d-1],[c-2,d-2],[c+1,d-1],[c+2,d-2],[c-1,d+1],[c-2,d+2],[c+1,d+1],[c+2,d+2]];for(var e=0;e<f.length;e++){var g=f[e];masterCanvas[g[0]+width*g[1]]=exitCol}}function mouseMove(a,b){a=a||window.event;if(drawing===0)return;var c=getCoords(a),d=Math.floor(-1+c[0]/zoomFactor),e=Math.floor(-1+c[1]/zoomFactor);keyBuffer[16]&&(lastX=lastDrawPosX,lastY=lastDrawPosY);var f;interpolateBrush[activeTool]===!1||lastX<0||lastY<0?f=[[d,e]]:f=line(lastX,lastY,d,e);var g=drawFuncs[activeTool];for(var h=0;h<f.length;h++){var i=f[h];g(i[0],i[1])}var j=canvasses[0];for(var h=0;h<j.length;h++)j[h]=masterCanvas[h];setVisuals(!0);var c=getCoords(a);lastX=Math.floor(-1+c[0]/zoomFactor),lastY=Math.floor(-1+c[1]/zoomFactor),lastDrawPosX=d,lastDrawPosY=e,stateIndex!==0&&compile()}function compile(){dirty=!1,boundingBoxes={},pivotPoints={},exitTriggered=!1;for(var a=0;a<width*height;a++)regionCanvas[a]=0;regionTypes=[];var b=0;ballSpawnPointX=0,ballSpawnPointY=0;var c=0;exitPointX=0,exitPointY=0,regionCanvasCount=2;for(var d=0;d<width;d++)for(var e=0;e<height;e++){if(regionCanvas[d+width*e]===0){var f=masterCanvas[d+width*e];f===eraserCol||f===bumperAuraCol?regionCanvas[d+width*e]=eraserCol:f===wallCol?regionCanvas[d+width*e]=wallCol:(fillRegion(d,e,regionCanvasCount+1),regionCanvasCount++)}masterCanvas[d+width*e]===ballSpawnCol&&(ballSpawnPointX+=d,ballSpawnPointY+=e,b++),masterCanvas[d+width*e]===exitCol&&(exitPointX+=d,exitPointY+=e,c++)}b>0?(ballSpawnPointX/=b,ballSpawnPointY/=b,ballSpawnPointX-=2,ballSpawnPointY-=2):(ballSpawnPointX=width/2,ballSpawnPointY=height/2),c===0?(exitPointX=-1e4,exitPointY=-1e4):(exitPointX/=c,exitPointY/=c),drawBB(),scrunchSprings(),generateSweepOffsets(),makeConnections(),hasLeftPaddle=!1,hasRightPaddle=!1,hasSpring=!1;for(var a in pivotPoints){var g=pivotPoints[a];g[2]===1?hasLeftPaddle=!0:g[2]===2&&(hasRightPaddle=!0)}for(var a=0;a<regionTypes.length;a++)regionTypes[a]===springCol&&(hasSpring=!0);setVisuals(!0),gameLevelCount=1;for(var a=1;a<layerCount;a++){var h=levelCanvasses[a];for(var i=0;i<width*height;i++)if(h[i]!==0){gameLevelCount++;break}if(gameLevelCount===a)break}console.log("level count = "+gameLevelCount)}function setScoreText(a){PLAYER===!0&&(scoreText.innerText=score,a===!0&&(highScoreText.innerText=highScore)),oldscore=score}function spawnBall(){score=0,setScoreText(!0),bpx=ballSpawnPointX,bpy=ballSpawnPointY,ballSpin=0,speedX=0,speedY=0,playSound(43637308,!0)}function fillRegion(a,b,c){var d=masterCanvas[a+width*b],e=d===leftFlipperPivotCol||d===rightFlipperPivotCol||d===flipperCol;d===leftFlipperPivotCol?pivotPoints[c]=[a,b,1]:d===rightFlipperPivotCol&&(pivotPoints[c]=[a,b,2]),regionCoordIndex=a+width*b,regionCanvas[regionCoordIndex]=c,regionTypes[c]=masterCanvas[regionCoordIndex],c in boundingBoxes?(bbox=boundingBoxes[c],bbox[0]=Math.min(bbox[0],i),bbox[1]=Math.min(bbox[1],j),bbox[2]=Math.max(bbox[2],i),bbox[3]=Math.max(bbox[3],j)):boundingBoxes[c]=[a,b,a,b];var f=[[a+1,b],[a-1,b],[a,b+1],[a,b-1]];for(var g=0;g<f.length;g++){var h=f[g],i=h[0],j=h[1];if(i>=0&&i<width&&j>=0&&j<height&&masterCanvas[i+width*j]>wallCol&&regionCanvas[i+width*j]===0){var k=masterCanvas[i+width*j];if(k==d||e&&(k===leftFlipperPivotCol||k===rightFlipperPivotCol||k===flipperCol))regionCanvas[i+width*j]=c,f.push([i+1,j]),f.push([i-1,j]),f.push([i,j+1]),f.push([i,j-1]),c in boundingBoxes?(bbox=boundingBoxes[c],bbox[0]=Math.min(bbox[0],i),bbox[1]=Math.min(bbox[1],j),bbox[2]=Math.max(bbox[2],i),bbox[3]=Math.max(bbox[3],j)):boundingBoxes[c]=[i,j,i,j],e&&(k===leftFlipperPivotCol?pivotPoints[c]=[i,j,1]:k===rightFlipperPivotCol&&(pivotPoints[c]=[i,j,2]))}}}function scrunchSprings(){var a=uint8ar_copy(canvasses[0]),b=uint8ar_copy(canvasses[1]),c=uint8ar_copy(canvasses[2]),d=uint8ar_copy(canvasses[3]);canvasses[4]=a,canvasses[5]=b,canvasses[6]=c,canvasses[7]=d;for(var e=0;e<regionCanvas.length;e++){var f=regionCanvas[e];regionTypes[f]===springCol&&(a[e]=0,b[e]=0,c[e]=0,d[e]=0)}for(var g in boundingBoxes){var f=Number(g);if(regionTypes[f]!==springCol)continue;var h=boundingBoxes[f],i=h[3];for(var j=h[0];j<=h[2];j++)for(var k=h[1];k<=h[3];k++){var e=j+width*k;if(regionCanvas[e]===f){var l=(k-i)/2+i;l=Math.round(l),a[j+width*l]=springCol,b[j+width*l]=springCol,c[j+width*l]=springCol,d[j+width*l]=springCol}}}}function generateSweepSprings(a,b){var c=canvasses[a],d=canvasses[b],e=sweepAreas[a][b],f=sweepAreas[b][a];for(var g in boundingBoxes){var h=Number(g);if(regionTypes[h]!==springCol)continue;var i=boundingBoxes[h],j=i[3],k=i[1],l=j-k;for(var m=i[0];m<=i[2];m++)for(var n=i[1];n<=i[3];n++){var o=m+width*n;if(regionCanvas[o]===h){var p=j-n,q=Math.round(p/2),r=m,s=j-q,t=r+width*s;while(t>0&&t<width*height){var u=d[t];if(u<=eraserCol||u===bumperAuraCol)break;t-=width}var v=m,w=n,x=v+width*w;while(x>0&&x<width*height){var y=c[x];if(y<=eraserCol||y===bumperAuraCol)break;x-=width}var z=line(m,n,Math.round(r),Math.round(s));for(var A=0;A<z.length;A++){var B=z[A],C=B[0],D=B[1],E=C+width*D;e[E]=t,f[E]=x}}}}}function clickPlay(){compile(),spawnBall(),setVisuals()}function generateSweepCanvasPair(a,b,c){var d=canvasses[a],e=b>=0?canvasses[b]:null,f=c>=0?canvasses[c]:null,g=b>=0?sweepAreas[a][b]:null,h=c>=0?sweepAreas[a][c]:null,i=b>=0?sweepAreas[b][a]:null,j=c>=0?sweepAreas[c][a]:null;for(var k in pivotPoints){var l=Number(k),m=pivotPoints[l],n=boundingBoxes[l],o=m[2],p,q=30,r,p,s,t;o===1?(q=-q,p=e,s=g,t=i):o===2&&(q=q,p=f,s=h,t=j);if(p===null)continue;var u=m[0],v=m[1];theta=Math.PI*q/180;for(var w=n[0];w<=n[2];w++)for(var x=n[1];x<=n[3];x++){var y=w+width*x;if(regionCanvas[y]===l){var z=w-u,A=x-v,B=u+Math.cos(theta)*z-Math.sin(theta)*A,C=v+Math.sin(theta)*z+Math.cos(theta)*A,D=Math.round(B),E=Math.round(C),F=-1;o===1?B<u&&(F=1):B>=u&&(F=1);var G=D+width*E;while(G>0&&G<width*height){var H=p[G];if(H<=eraserCol||H===bumperAuraCol)break;G+=F*width}var I=w,J=x,K=I+width*J;while(K>0&&K<width*height){var L=d[K];if(L<=eraserCol||L===bumperAuraCol)break;K-=F*width}var M=line(w,x,Math.round(D),Math.round(E));for(var N=0;N<M.length;N++){var O=M[N],P=O[0],Q=O[1],R=P+width*Q;s[R]=G,t[R]=K}}}}}function generateSweepOffsets(){for(var a=0;a<8;a++)sweepAreas[a]=[];sweepAreas[NONE][LEFT]=new Uint32Array(width*height),sweepAreas[NONE][RIGHT]=new Uint32Array(width*height),sweepAreas[LEFT][NONE]=new Uint32Array(width*height),sweepAreas[RIGHT][NONE]=new Uint32Array(width*height),generateSweepCanvasPair(NONE,LEFT,RIGHT),sweepAreas[LEFT][LEFT+RIGHT]=new Uint32Array(width*height),sweepAreas[LEFT+RIGHT][LEFT]=new Uint32Array(width*height),generateSweepCanvasPair(LEFT,-1,LEFT+RIGHT),sweepAreas[RIGHT][LEFT+RIGHT]=new Uint32Array(width*height),sweepAreas[LEFT+RIGHT][RIGHT]=new Uint32Array(width*height),generateSweepCanvasPair(RIGHT,LEFT+RIGHT,-1),sweepAreas[DOWN+LEFT][DOWN+LEFT+RIGHT]=new Uint32Array(width*height),sweepAreas[DOWN+LEFT+RIGHT][DOWN+LEFT]=new Uint32Array(width*height),generateSweepCanvasPair(DOWN+LEFT,-1,DOWN+LEFT+RIGHT),sweepAreas[DOWN+RIGHT][DOWN+LEFT+RIGHT]=new Uint32Array(width*height),sweepAreas[DOWN+LEFT+RIGHT][DOWN+RIGHT]=new Uint32Array(width*height),generateSweepCanvasPair(DOWN+RIGHT,DOWN+LEFT+RIGHT,-1),sweepAreas[DOWN][DOWN+LEFT]=new Uint32Array(width*height),sweepAreas[DOWN][DOWN+RIGHT]=new Uint32Array(width*height),sweepAreas[DOWN+LEFT][DOWN]=new Uint32Array(width*height),sweepAreas[DOWN+RIGHT][DOWN]=new Uint32Array(width*height),generateSweepCanvasPair(DOWN,DOWN+LEFT,DOWN+RIGHT),sweepAreas[DOWN][NONE]=new Uint32Array(width*height),sweepAreas[NONE][DOWN]=new Uint32Array(width*height),generateSweepSprings(NONE,DOWN),sweepAreas[LEFT][DOWN+LEFT]=new Uint32Array(width*height),sweepAreas[DOWN+LEFT][LEFT]=new Uint32Array(width*height),generateSweepSprings(LEFT,LEFT+DOWN),sweepAreas[RIGHT][DOWN+RIGHT]=new Uint32Array(width*height),sweepAreas[DOWN+RIGHT][RIGHT]=new Uint32Array(width*height),generateSweepSprings(RIGHT,RIGHT+DOWN),sweepAreas[LEFT+RIGHT][DOWN+LEFT+RIGHT]=new Uint32Array(width*height),sweepAreas[DOWN+LEFT+RIGHT][LEFT+RIGHT]=new Uint32Array(width*height),generateSweepSprings(LEFT+RIGHT,LEFT+RIGHT+DOWN)}function drawBB(){var a=uint8ar_copy(masterCanvas),b=uint8ar_copy(masterCanvas),c=uint8ar_copy(masterCanvas),d=uint8ar_copy(masterCanvas);canvasses[0]=a,canvasses[1]=b,canvasses[2]=c,canvasses[3]=d;for(var e=0;e<regionCanvas.length;e++){var f=regionCanvas[e];f in pivotPoints&&(pivotPoints[f][2]===1?(b[e]=0,d[e]=0):(c[e]=0,d[e]=0))}for(var g in pivotPoints){var f=Number(g),h=pivotPoints[f],i=boundingBoxes[f],j=h[2],k,l=30,m;j===1?(l=-l,k=b,m=leftFlipperPivotCol):(k=c,m=rightFlipperPivotCol);var n=h[0],o=h[1];theta=Math.PI*l/180;for(var p=i[0];p<=i[2];p++)for(var q=i[1];q<=i[3];q++){var e=p+width*q;if(regionCanvas[e]===f){var r=p-n,s=q-o,t=n+Math.cos(theta)*r-Math.sin(theta)*s,u=o+Math.sin(theta)*r+Math.cos(theta)*s,v=[[Math.floor(t),Math.floor(u)],[Math.floor(t),Math.ceil(u)],[Math.ceil(t),Math.ceil(u)],[Math.ceil(t),Math.floor(u)]];for(var w=0;w<v.length;w++){var x=v[w],y=x[0],z=x[1];if(y>=0&&z>=0&&y<width&&z<height){var A=y+width*z;k[A]=flipperCol,d[A]=flipperCol}}}}d[n+width*o]=m,k[n+width*o]=m}}function cyclePalette(a){var b=colorPalette.length-1;mainPaletteOffset=(mainPaletteOffset+b+a)%b,colorPalette=[];for(var c=1;c<sourcePalette.length;c++)colorPalette[c]=sourcePalette[(c+mainPaletteOffset-1)%b+1];colorPalette[0]=colorPalette[1];for(var c=0;c<16;c++)elem=document.getElementById("color_"+c),elem!==null&&(elem.style.backgroundColor=colorPalette[c],colorElem[c]=elem);elem=document.getElementById("colorOffsetChoice"),elem!==null&&(elem.style.backgroundColor=colorPalette[0]),setVisuals(!0,!0)}function calcHalo(){for(var a=1;a<width-1;a++)for(var b=1;b<height-1;b++){var c=masterCanvas[a+width*b];if(c===0||c===bumperAuraCol){var d=[[a-1,b-1],[a,b-1],[a+1,b-1],[a-1,b],[a+1,b],[a-1,b+1],[a,b+1],[a+1,b+1]];masterCanvas[a+width*b]=0;for(var e=0;e<d.length;e++){var f=d[e],g=f[0],h=f[1],i=masterCanvas[g+width*h];if(i===bumperCol){masterCanvas[a+width*b]=bumperAuraCol;break}}}}var j=canvasses[0];for(var e=0;e<masterCanvas.length;e++)j[e]=masterCanvas[e]}function floodFill(a,b,c,d){var e=[[b,c]];originColor=a[b+width*c];if(originColor===d)return;for(var f=0;f<e.length;f++){var g=e[f],h=g[0]+width*g[1];if(a[h]===d)continue;a[h]=d,borderPoints=[[g[0]+1,g[1]],[g[0]-1,g[1]],[g[0],g[1]+1],[g[0],g[1]-1]];for(var i=0;i<borderPoints.length;i++){var j=borderPoints[i],k=j[0],l=j[1],m=bpx+width*bpy;k>=0&&k<width&&l>=0&&l<height&&a[m]===originColor&&e.push([k,l])}}}var contexts=new Array,version="0.1",gameTitle="My Game",gameLink="www.plingpling.org",winText="Congratulations! You won!",width=125,height=140,zoomFactor=4,radius=5,stateIndex=0,canvasIndex=0,canvasses=new Array,VERSION=2;for(var i=0;i<16;i++)canvasses[i]=new Uint8Array(width*height);var dirty=!1,exitTriggered=!1,exitPointX=-1e3,exitPointY=-1e3,visibleCanvas,visibleContext,titleInput,linkInput,scoreText,highScoreText,winTextInput,id,id_d,loaded=!1,lastX=-1,lastY=-1,shareLinkInner,mainPaletteOffset=0,layerCount=6,levelCanvasses=new Array;for(var i=0;i<layerCount;i++)levelCanvasses[i]=new Uint8Array(width*height);var lastDrawPosX=-1,lastDrawPosY=-1,score=0,highScore=0,regionCanvasCount=2,regionCanvas=new Uint32Array(width*height),pivotPoints=[],boundingBoxes={},regionTypes=[],masterCanvas=new Uint8Array(width*height),gameLevelCount=1,sourcePalette=["#000000","#000000","#c2c2c2","#0000ff","#bfe3f3","#ff8700","#ffff00","#b4772c","#ff0000","#00bd00","#bc4499","#ffaf00","#00ffff","#ffadd5","#000079","#8f0000","#ff99ff","#351d1d","#8888ff"],colorPalette=sourcePalette,layerElem=new Array,thumbnailCanvas=new Array,thumbnailContext=new Array,eraserCol=0,wallCol=2,bumperCol=3,bumperAuraCol=14,flipperCol=4,leftFlipperPivotCol=5,rightFlipperPivotCol=8,ballSpawnCol=15,connectionCol=9,targetCol=10,targetActiveCol=16,togglableWallCol=11,togglableWallDisabledCol=17,exitCol=6,springCol=12,lastPlacedLeftPivot=!1,colorElem=new Array,aurl=document.createElement("a"),standalone_HTML_String="";if(PLAYER!==!0){var clientStandaloneRequest=new XMLHttpRequest;clientStandaloneRequest.open("GET","play_inlined.txt"),clientStandaloneRequest.onreadystatechange=function(){if(clientStandaloneRequest.readyState!=4)return;standalone_HTML_String=clientStandaloneRequest.responseText},clientStandaloneRequest.send()}var get_blob=function(){return self.Blob};Array.prototype.unique=function(){var a=this.concat();for(var b=0;b<a.length;++b)for(var c=b+1;c<a.length;++c)a[b]===a[c]&&a.splice(c--,1);return a};var connections=[];document.addEventListener("keydown",press),document.addEventListener("keyup",keyup);var copyImage=null,savedString,keyBuffer=[],hasLeftPaddle=!0,hasRightPaddle=!0,hasSpring=!0,tilting=!1,bucketElem,colorElem=new Array,ballSpawnPointX=width/2,ballSpawnPointY=height/2,bpx=-2e3,bpy=-2e3,ballFrame=0,ballPointFrames=[[[1,0],[2,0],[0,1],[1,1],[3,1],[0,2],[3,2],[1,3],[2,3]],[[1,0],[2,0],[0,1],[2,1],[3,1],[0,2],[3,2],[1,3],[2,3]],[[1,0],[2,0],[0,1],[3,1],[0,2],[2,2],[3,2],[1,3],[2,3]],[[1,0],[2,0],[0,1],[3,1],[0,2],[1,2],[3,2],[1,3],[2,3]]];activatedConnections=[];var ballOffsets=[[1,0],[2,0],[0,1],[1,1],[2,1],[3,1],[0,2],[1,2],[2,2],[3,2],[1,3],[2,3]],speedX=0,speedY=1,ballSpin=1,tickRecalcs=0,tickLength=33,bounceDamp=.8,bumperSpeed=2,maxSpeed=3,maxBallSpin=4,spinDamp=2e-4,ballSpinSpeed=.4,bumperHit=-1,lastsoundpos_bump=-1,oldscore=0,lastbpx,lastbpy,lastBallFrame=ballFrame,wonindex=4,drawing=0,undoList=new Array,activeTool="wall",fillCanvas=new Uint8Array(width*height),interpolateBrush={eraser:!0,wall:!0,bumper:!0,flipper:!0,leftFlipperPivot:!1,rightFlipperPivot:!1,ballSpawn:!1,connection:!0,target:!0,togglableWall:!0,spring:!0,exitPoint:!1},drawFuncs={eraser:eraserDraw,wall:wallDraw,bumper:bumperDraw,flipper:flipperDraw,leftFlipperPivot:leftFlipperPivotDraw,rightFlipperPivot:rightFlipperPivotDraw,ballSpawn:ballSpawnDraw,connection:connectionDraw,target:targetDraw,togglableWall:togglableWallDraw,spring:springDraw,exitPoint:exitPointDraw},NONE=0,DOWN=4,LEFT=1,RIGHT=2,sweepAreas=[]
</script>
</head>
<body onload="init();" ondragstart="return false;" ondrop="return false;" style="">
<center>
<table><tr>
	<td>
	<canvas id="mainCanvas" width="500" height="560"></canvas>
	</td>
	<td valign="top" width="200" id="right">
	<div><h1 id="gameTitleHeader">plingpling.org game maker</h1></div>
<p id="hackArea">
 <a href="http://www.plingpling.org" id="hackLink"></a>
 </p><p>
	<hr />
	<div> <a id="homepageLinkPlayer" href="http://www.plingpling.org">www.plingpling.org</a></div>
	<hr />
	<div><h3 style="text-align:center;">Hi Score : <span id="highScoreText"></span> pts</h3></div></p><p>
	<div><h3 style="text-align:center;">Score : <span id="scoreText"></span> pts</h3></div></p><p>
	<div id="ballCount" style="text-align:center;"><h2>â balls</h2></div>
	</p><p>
	<table style="border:0">
		<tr>
		<td colspan="2" style="border:0">
		<b>Controls:<b>
		</b></b></td>
		</tr>
		<tr><td style="border:0">
		<b>LEFT</b>/<b>RIGHT</b> </td><td style="border:0"> flippers</td>
		</tr>
		<tr>
		<td style="border:0"><b>DOWN</b> </td><td style="border:0"> launcher</td>
		</tr><tr>
		<td style="border:0"><b>UP</b></td> <td style="border:0"> tilt</td>
		</tr>
		<tr>
		<td style="border:0"><b>R</b> </td><td style="border:0"> respawn</td>
		</tr>
		</table>
</p></td></tr>
</table>

</center>
</body>
</html>